<!doctype html>
<html>
<head>
<title></title>
<style>
body {
	padding: 20px;
	cursor: default;
	font: normal 12pt Arial;
	line-height:1.4em;
	padding-left: 20px;
	padding-bottom: 100px;
}

#ui {
	user-select: none;
	-moz-user-select: none;
	-webkit-user-select: none;
	-ms-user-select: none;
}

div {
	max-width: 600px;
	margin: 0 auto;
}

div p {
	margin: 0 0 20px 0;
}

div.head {
	padding-bottom: 20px;
}

div.line {
	border-top: 1px solid #ccc;
	margin: 20px 0;
}

div.doors {
	display: flex;
	justify-content: center;
	align-items: center;
	padding: 0;
}

div.doors div.door {
	display: inline-block;
	position: relative;
	width: 90px;
	height: 90px;
	font-size: 50pt;
	line-height: normal;
}

div.doors div.door.door_pointer {
	cursor: pointer;
}

div.doors div.door span.door_your_choice,
div.doors div.door span.door_sheep,
div.doors div.door span.door_car {
	position: absolute;
	right: 0;
	bottom: 0;
	font-size: 45pt;
}

</style>
</head>
<body>
	<div class="head">
		<strong>–ü–∞—Ä–∞–¥–æ–∫—Å –ú–æ–Ω—Ç–∏ –•–æ–ª–ª–∞</strong><br>
		<a href="https://ru.wikipedia.org/wiki/–ü–∞—Ä–∞–¥–æ–∫—Å_–ú–æ–Ω—Ç–∏_–•–æ–ª–ª–∞">https://ru.wikipedia.org/wiki/–ü–∞—Ä–∞–¥–æ–∫—Å_–ú–æ–Ω—Ç–∏_–•–æ–ª–ª–∞</a> [<a href="https://en.wikipedia.org/wiki/Monty_Hall_problem">en</a>]
	</div>
	
	<div id="ui"></div>

<script type="text/javascript">
(function(){

	const 
		YOUR_CHOICE = 'YOUR_CHOICE'
		SHEEP = 'SHEEP',
		CAR = 'CAR',
		DOOR = 'DOOR'
		MAP_TO_EMOJI = {
			DOOR: 'üö™',
			YOUR_CHOICE: 'üîë',
			SHEEP: 'üêë',
			CAR: 'üöò'
		}
		;

	let 
		start,
		restart,
		doors,
		car_in,
		draw_doors,
		first_answer,
		finish,
		monti,
		ui,
		uiElement,
		get_rand = (min, max)=>{ return Math.floor(Math.random() * (max - min + 1)) + min },
		body = document.getElementById('ui')
		;

	ui = function(str){
		str += '';
		if(str === 'line') {
			str = '<div class="line"></div>';
		} else {
			str = '<p>' + str.replace('\n', '<br/>') + '</p>';
		}

		body.insertAdjacentHTML('beforeend', '<div>' + str + '</div>');
	};

	uiElement = function(obj){
		body.insertAdjacentElement('beforeend', obj);
	};

	draw_doors = function(){
		// wrapper
		let _doors = document.createElement('div');
		_doors.setAttribute('class','doors');
		
		let _handlers = [];
		let remove_handler = function(){
			let nodes = _doors.childNodes;
			let iterate = -1;
			for(let node of nodes){
				node.removeEventListener( 'click', _handlers[++iterate] );
				node.className = node.className.replace(' door_pointer', '');
			}
		};
		for(let c = 0; c < 3; ++c){
			let can_be_opened = !(doors[c].t === SHEEP);

			let _door = document.createElement('div');
			_door.setAttribute('class', 'door' + (can_be_opened ? ' door_pointer' : ''));
			_door.setAttribute('data-num', c + 1)
			_door.innerText = MAP_TO_EMOJI[DOOR];

			if( !!doors[c].t && doors[c].t !== DOOR ) {
				let child = document.createElement('span');
				child.className = 'door_' + doors[c].t.toString().toLocaleLowerCase();
				child.innerHTML = MAP_TO_EMOJI[doors[c].t];
				_door.insertAdjacentElement( 'beforeend', child );
			}

			if(can_be_opened){
				_handlers.push(function(){
					let child = document.createElement('span');
					child.className = 'door_' + YOUR_CHOICE.toLocaleLowerCase();
					child.innerHTML = MAP_TO_EMOJI[YOUR_CHOICE];
					this.insertAdjacentElement('beforeend', child);
					setTimeout(monti.bind(null, c+1), 50);
					remove_handler();
				});
			} else {
				_handlers.push(()=>{});
			}
			_door.addEventListener('click', _handlers[c]);

			_doors.insertAdjacentElement('beforeend', _door);
		};
		uiElement( _doors );
	};

	start = function(){
		first_answer = null;
		doors = [{t: DOOR, v: SHEEP}, {t: DOOR, v: SHEEP}, {t: DOOR, v: SHEEP}];
		car_in = get_rand(0, 2);
		doors[car_in].v = CAR;
		
		body.innerHTML = '';
		ui(`–ó–∞ –¥–≤—É–º—è –¥–≤–µ—Ä—å–º–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –æ–≤—Ü—ã, –∑–∞ –¥—Ä—É–≥–æ–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å –º–µ—á—Ç—ã.
			–û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ —É–≥–∞–¥–∞—Ç—å –∑–∞ –∫–∞–∫–æ–π. –í—ã–±–∏—Ä–∞–π –¥–≤–µ—Ä—å!`);
		
		draw_doors();
		ui('line');
	};
	start();
	restart = start;

	window.onkeyup = function(e){
		code =  e.which || e.keyCode;
		// let map = {49: 1, 50: 2, 51: 3};
		// monti(map[code]);

		if(code === 13) {
			restart();
		}
	};
	
	monti = function( answer ){
		if(!answer){
			return '–£–∫–∞–∂–∏ –¥–≤–µ—Ä—å!';
		}

		--answer;

		if( first_answer !== null ) {
			return finish(answer);
		}

		ui('–¢—ã –≤—ã–±–∏—Ä–∞–µ—à—å –¥–≤–µ—Ä—å: ' + (answer+1) );

		let sheep_door,
			need = true,
		 	closed_door = '123';
		
		closed_door = closed_door.replace(answer, '');

		while(need){
			sheep_door = get_rand(0, 2)
			if( !(sheep_door == answer) && (doors[sheep_door].v !== CAR) ) {
				doors[sheep_door].t = doors[sheep_door].v;
				closed_door = closed_door.replace((sheep_door + 1), '');
				need = false;
			}
		}


		let comment = `–ú–æ–Ω—Ç–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥—Ä—É–≥—É—é –¥–≤–µ—Ä—å, –æ–¥–Ω—É –∏–∑ –Ω–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö, –≤ –∫–æ–º–Ω–∞—Ç–µ –∑–∞ –Ω–µ–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –æ–≤—Ü–∞. –£ —Ç–µ–±—è –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä –¥–≤–µ—Ä–∏. 
			–ö–∞–∫—É—é –≤—ã–±–µ—Ä–µ—à—å?`;
		ui(comment);

		draw_doors();
		
		first_answer = answer;
		ui('line');
	};

	finish = function(answer){

		if( doors[answer].t === SHEEP ) {
			return '–ù–µ –º–æ–∂–µ—à—å –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —ç—Ç—É –¥–≤–µ—Ä—å.';
		}

		for(let c=0;c<3;++c){
			doors[c].t = doors[c].v;
		}

		let other_variant = answer !== first_answer;
		let win = false;
		if( doors[answer].v === CAR ) {
			win = true;
		}

		// let comment = `–í–∏–¥–∏–º–æ —Ç—ã —Ä–∞–∑–±–∏—Ä–∞–µ—à—å—Å—è –≤ —Ç–µ–æ—Ä–∏–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏, –∏–ª–∏ —Å–º–æ—Ç—Ä–µ–ª —Å–º–æ—Ç—Ä–µ–ª —Ñ–∏–ª—å–º &laquo;<a href="https://www.kinopoisk.ru/film/195847/">21</a>&raquo; –∏ –ø–æ—ç—Ç–æ–º—É –≤—ã–±–∏—Ä–∞–µ—à—å –¥—Ä—É–≥—É—é –¥–≤–µ—Ä—å, –∂–µ–ª–∞—è –ø–æ–≤—ã—Å–∏—Ç—å —Å–≤–æ–∏ —à–∞–Ω—Å—ã –Ω–∞ –≤—ã–∏–≥—Ä—ã—à.
			// –ï—Å–ª–∏ —Ç—ã –Ω–µ –ø–æ–Ω–∏–º–∞–µ—à—å –æ —á–µ–º –Ω–∞–ø–∏—Å–∞–Ω–æ –≤—ã—à–µ, –ø–æ—Å–º–æ—Ç—Ä–∏ <a href="https://www.youtube.com/watch?v=FDU0n-j0Xic">—ç—Ç–æ –≤–∏–¥–µ–æ</a> –∏ –ø–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑.`;

		let selected_door,
			result_text;

		if( win && other_variant ) {
			selected_door = '–¢—ã —Ä–µ—à–∞–µ—à—å –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –¥–≤–µ—Ä—å:';
			result_text = '–ò —ç—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç —Ç–µ–±—è –∫ –ø–æ–±–µ–¥–µ! –í—Å–µ —Ç–µ–±—è –ø–æ–∑–¥—Ä–∞–≤–ª—è—é—Ç!';
		} else if( win && !other_variant ) {
			selected_door = '–¢—ã –¥–æ–≤–µ—Ä—è–µ—à—å—Å—è "—á—É–π–∫–µ" –∏ –æ—Å—Ç–∞–≤–ª—è–µ—à—å –¥–≤–µ—Ä—å —Å –∫–æ—Ç–æ—Ä–æ–π –Ω–∞—á–∏–Ω–∞–ª: ';
			result_text = '–¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ —Ç–æ–∂–µ –∏–º–µ–µ—Ç —à–∞–Ω—Å –Ω–∞ –ø–æ–±–µ–¥—É, –∏ –≤ —ç—Ç–æ—Ç —Ä–∞–∑ –æ–Ω —Ç–µ–±—è –Ω–µ –ø–æ–¥–≤–µ–ª!';
		} else if( !win && other_variant ) {
			selected_door = '–¢—ã —Ä–µ—à–∞–µ—à—å –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –¥–≤–µ—Ä—å: ';
			result_text = '–û–¥–Ω–∞–∫–æ –≤ —ç—Ç–æ—Ç —Ä–∞–∑ –≥–ª–∞–≤–Ω—ã–π –ø—Ä–∏–∑ –æ–∫–∞–∑–∞–ª—Å—è –∑–∞ –¥–≤–µ—Ä—å—é —á—Ç–æ –±—ã–ª–∞ –≤—ã–±—Ä–∞–Ω–∞ –ø–µ—Ä–≤–æ–π.';
		} else if(!win && !other_variant) {
			selected_door = '–¢—ã —Ä–µ—à–∞–µ—à—å –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –Ω–∞ —Ç–æ–π –∂–µ –¥–≤–µ—Ä–∏: ';
			result_text = '–ò —ç—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ç–æ–º—É —á—Ç–æ —Ç–≤–æ–π —Å–æ–ø–µ—Ä–Ω–∏–∫ —É–µ–∑–∂–∞–µ—Ç –Ω–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ —á—Ç–æ –º–æ–≥ –¥–æ—Å—Ç–∞—Ç—å—Å—è —Ç–µ–±–µ.';
		}

		ui(selected_door + (answer + 1));
		ui(result_text);
		draw_doors();

		ui('line');

		let help = `</p>
		<strong>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–π</strong>
		<br/><br/>

		–í–∏–∫–∏–ø–µ–¥–∏—è: <a href="https://ru.wikipedia.org/wiki/–ü–∞—Ä–∞–¥–æ–∫—Å_–ú–æ–Ω—Ç–∏_–•–æ–ª–ª–∞">https://ru.wikipedia.org/wiki/–ü–∞—Ä–∞–¥–æ–∫—Å_–ú–æ–Ω—Ç–∏_–•–æ–ª–ª–∞</a>
		<p>–ü–∞—Ä–∞–¥–æ–∫—Å –ú–æ–Ω—Ç–∏ –•–æ–ª–ª–∞ ‚Äî –æ–¥–Ω–∞ –∏–∑ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∑–∞–¥–∞—á —Ç–µ–æ—Ä–∏–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π, —Ä–µ—à–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–π, –Ω–∞ –ø–µ—Ä–≤—ã–π –≤–∑–≥–ª—è–¥, –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç –∑–¥—Ä–∞–≤–æ–º—É —Å–º—ã—Å–ª—É.</p>
		
		–§–∏–ª—å–º &laquo;<a href="https://www.kinopoisk.ru/film/195847/">–î–≤–∞–¥—Ü–∞—Ç—å –æ–¥–Ω–æ</a>&raquo;
		<p>–ö–∞—Ä—Ç–æ—á–Ω–∞—è –∏–≥—Ä–∞ ‚Äî –∫–æ–º–±–∏–Ω–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–∞—Å—á–µ—Ç–æ–≤, –ø—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω—ã—Ö –∞–∫—Ç–µ—Ä—Å–∫–∏—Ö —Ç–∞–ª–∞–Ω—Ç–æ–≤ –∏ —Ö–ª–∞–¥–Ω–æ–∫—Ä–æ–≤–Ω–æ–π –≤—ã–¥–µ—Ä–∂–∫–∏. –ö–∞—Ä—Ç–æ—á–Ω—ã–π –∏–≥—Ä–æ–∫ ‚Äî —á–µ–ª–æ–≤–µ–∫ –æ—Å–æ–±–æ–≥–æ —Å–∫–ª–∞–¥–∞. –ú–æ–ª–æ–¥—ã–µ –ª—é–¥–∏ —Ä–µ—à–∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–Ω—É—Ç—å –∞—Ñ–µ—Ä—É –≤–µ–∫–∞ –∏ —Ä–∞–∑–æ—Ä–∏—Ç—å –∫—Ä—É–ø–Ω–µ–π—à–∏–µ –∫–∞–∑–∏–Ω–æ —Å—Ç—Ä–∞–Ω—ã –Ω–∞ –∞—Å—Ç—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫—É—é —Å—É–º–º—É. –û–Ω–∏ —Ä–µ—à–∏–ª–∏ –≤–∑—è—Ç—å –í–µ–≥–∞—Å! –ò—Ö –ø—è—Ç–µ—Ä–æ. –ò–≥—Ä–∞ –∑–∞—Ö–≤–∞—Ç–∏–ª–∞ –∏—Ö —Ü–µ–ª–∏–∫–æ–º. –ò—Ö –∏–≥—Ä–∞ –ø–æ—Ä–∞–∑–∏–ª–∞ —Å–≤–æ–µ–π –≤–∏—Ä—Ç—É–æ–∑–Ω–æ—Å—Ç—å—é. –û–Ω–∏ –∏–∑–º–µ–Ω–∏–ª–∏ —Ö–æ–¥ —Å–∞–º–æ–π –∏–≥—Ä—ã.</p>

		<a href="https://www.youtube.com/watch?v=FDU0n-j0Xic">–í–∏–¥–µ–æ –Ω–∞ —é—Ç—É–±–µ –ø—Ä–æ –ø—Ä–µ–¥–∏—Å—Ç–æ—Ä–∏—é –≤–æ–ø—Ä–æ—Å–∞ –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é</a> [ru]
		<p>–ü–µ—Ä–µ–≤–æ–¥ –≤–∏–¥–µ–æ —Å –∫–∞–Ω–∞–ª–∞ "Numberphile". –í–µ—Ä—Å–∏—è –≤–∏–¥–µ–æ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º - <a href="https://www.youtube.com/watch?v=4Lb-6rxZxx0">https://www.youtube.com/watch?v=4Lb-6rxZxx0</a></p>

		<a href="http://madastronomy.freeiz.com/monty/monty.php">–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç</a>
		<p>–ë–´–ª –Ω–∞–π–¥–µ–Ω –ø–æ–¥ –≤–∏–¥–µ–æ, —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ—Ç–æ—Ä–µ –≤—ã—à–µ.</p>

		<strong>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–π –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ</strong>

		<p>
		`;
		ui(help);
	};

})();

</script>
</body>
</html>